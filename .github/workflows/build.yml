name: Build APK – Hlasenia A (KivyMD 2.0.1-dev)

on:
  workflow_dispatch:          # ručné spustenie
  push:
    branches: [ main, master ] # alebo automaticky pri pushi

jobs:
  build:
    runs-on: ubuntu-22.04
    timeout-minutes: 60

    steps:
      - name: Checkout repozitára
        uses: actions/checkout@v4

      # Cache pre rýchlejšie buildy (SDK/NDK)
      - name: Cache Buildozer global directory
        uses: actions/cache@v4
        with:
          path: .buildozer_global
          key: buildozer-global-${{ hashFiles('buildozer.spec') }}

      # Hlavný krok: Build APK s Buildozer (automaticky SDK + NDK 25b)
      - name: Build with Buildozer
        id: buildozer
        uses: ArtemSBulgakov/buildozer-action@v1
        with:
          command: android debug          # buildí debug APK
          buildozer_version: stable       # stabilná verzia Buildozer
          workdir: .                      # koreň projektu (kde je buildozer.spec)

      # Nahraj APK ako artifact
      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: HlaseniaA-APK
          path: ${{ steps.buildozer.outputs.filename }}  # automaticky nájde APK
          retention-days: 30

      # Info o úspechu
      - name: Build info
        if: success()
        run: |
          echo "APK úspešne zbuildované!"
          ls -lh bin/*.apk || echo "APK je v Artifacts vyššie."
